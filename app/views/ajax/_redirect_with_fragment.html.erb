<%# Locals: url %>
<script type="text/javascript">
  var url = <%= url.to_json %>;
  var hash = document.location.hash;

  // Remove leading # from the fragment
  if (hash.charAt(0) == '#') {
    hash = hash.substr(1);
  }

  // Remove leading / from the fragment if the URL already ends in a /
  // This prevents double-slashes.  Note we can't just replace all
  // double-slashes because the protocol includes //.
  if (url.charAt(url.length - 1) == '/' && hash.charAt(0) == '/') {
    hash = hash.substr(1);
  }

  document.location.href = url + hash;
</script>